"use strict";(()=>{var e={};e.id=908,e.ids=[908],e.modules={8802:e=>{e.exports=require("bcrypt")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,s)=>{Object.defineProperty(s,"l",{enumerable:!0,get:function(){return function e(s,r){return r in s?s[r]:"then"in s&&"function"==typeof s.then?s.then(s=>e(s,r)):"function"==typeof s&&"default"===r?s:void 0}}})},9188:(e,s,r)=>{r.r(s),r.d(s,{config:()=>P,default:()=>m,routeModule:()=>g});var n={};r.r(n),r.d(n,{config:()=>p,default:()=>f});var t=r(1802),o=r(7153),i=r(6249),a=r(3741),u=r(8802),c=r.n(u),l=r(9344),d=r.n(l);let p={api:{bodyParser:!0}};async function f(e,s){if("POST"!==e.method)return s.status(405).json({success:!1,message:"M\xe9todo no permitido"});try{if(!e.body)return s.status(400).json({success:!1,message:"Body vac\xedo. Enviar JSON v\xe1lido"});let{email:r,password:n}=e.body;if(!r||!n)return s.status(400).json({success:!1,message:"Se requiere correo electr\xf3nico y contrase\xf1a"});let[t]=await (0,a.I)("SELECT * FROM users WHERE email = ?",[r]);if(!t||0===t.length)return s.status(401).json({success:!1,message:"Credenciales inv\xe1lidas"});let o=t[0];if(!o)return s.status(401).json({success:!1,message:"Credenciales inv\xe1lidas"});let i=await c().compare(n,o.password);if(!i)return s.status(401).json({success:!1,message:"Credenciales inv\xe1lidas"});let u=process.env.JWT_SECRET;if(!u)return console.error("JWT_SECRET no est\xe1 configurado en las variables de entorno"),s.status(500).json({success:!1,message:"Error de configuraci\xf3n del servidor"});let l=d().sign({userId:o.id,username:o.username,role:o.role},u,{expiresIn:"1h"});s.status(200).json({success:!0,message:"Inicio de sesi\xf3n exitoso",token:l,user:{id:o.id,username:o.username,role:o.role}})}catch(e){console.error("Error de inicio de sesi\xf3n:",e),s.status(500).json({success:!1,message:"Error interno del servidor"})}}let m=(0,i.l)(n,"default"),P=(0,i.l)(n,"config"),g=new t.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/auth/login",pathname:"/api/auth/login",bundlePath:"",filename:""},userland:n})},3741:(e,s,r)=>{r.d(s,{I:()=>i});let n=require("mysql2/promise");var t=r.n(n);let o=t().createPool({host:process.env.MYSQL_HOST||"localhost",user:process.env.MYSQL_USER,password:process.env.MYSQL_PASSWORD,database:process.env.MYSQL_DATABASE||"sifygsadtb",waitForConnections:!0,connectionLimit:10,queueLimit:0});async function i(e,s){try{let[r]=await o.execute(e,s);return r}catch(e){throw console.error("Error en la consulta a la base de datos:",e),e}}},7153:(e,s)=>{var r;Object.defineProperty(s,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,s,r)=>{e.exports=r(145)}};var s=require("../../../webpack-api-runtime.js");s.C(e);var r=s(s.s=9188);module.exports=r})();