"use strict";(()=>{var e={};e.id=220,e.ids=[220],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},4838:(e,t,o)=>{o.r(t),o.d(t,{config:()=>d,default:()=>c,routeModule:()=>p});var n={};o.r(n),o.d(n,{default:()=>l});var r=o(1802),a=o(7153),s=o(6249),i=o(3741);let u=require("next-auth/react");async function l(e,t){let o=await (0,u.getSession)({req:e});if(!o||!o.user)return t.status(401).json({message:"No autorizado"});if("POST"===e.method)try{let{serviceType:n,address:r,postalCode:a,projectTypes:s,startDate:u,installations:l,budget:c,supportLevel:d,name:p,organization:P,email:f,phone:m}=e.body,A=await (0,i.I)(`INSERT INTO consultations 
        (client_id, service_type, location, postal_code, project_types, start_date, installations, budget, support_level, contact_name, organization, email, phone, status) 
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,[o.user.email,n,r,a,JSON.stringify(s),u,l,c,d,p,P,f,m,"pending"]);t.status(201).json({message:"Consulta creada exitosamente",id:A[0].insertId})}catch(e){console.error("Error al crear la consulta:",e),t.status(500).json({message:"Error interno del servidor"})}else t.setHeader("Allow",["POST"]),t.status(405).end(`M\xe9todo ${e.method} No Permitido`)}let c=(0,s.l)(n,"default"),d=(0,s.l)(n,"config"),p=new r.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/consultations",pathname:"/api/consultations",bundlePath:"",filename:""},userland:n})},3741:(e,t,o)=>{o.d(t,{I:()=>s});let n=require("mysql2/promise");var r=o.n(n);let a=r().createPool({host:process.env.MYSQL_HOST||"localhost",user:process.env.MYSQL_USER,password:process.env.MYSQL_PASSWORD,database:process.env.MYSQL_DATABASE||"sifygsadtb",waitForConnections:!0,connectionLimit:10,queueLimit:0});async function s(e,t){try{let[o]=await a.execute(e,t);return o}catch(e){throw console.error("Error en la consulta a la base de datos:",e),e}}},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var o=t(t.s=4838);module.exports=o})();